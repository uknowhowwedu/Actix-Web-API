# Actix Web API

An HTTP API implemented using the actix-web framework. It functions as the backend for a video game. It allows for routine account operations (changing passwords, upgrading, etc.) and the ability to manage game saves and users. This project was a portion of a more significant endeavor, taken on by a group of classmates and myself, to create a video game and service. Since the backend was solely my responsibility, I decided to write the API in Rust. This is my first project with the language, and I was interested in seeing how it fared in comparison with Flask. 

# Requirements

  - [docker](https://docs.docker.com/engine/install/)
  - [docker-compose](https://github.com/docker/compose)

# Installation

### Editing Config.toml

All incoming requests' Host header must match the value assigned to **domain**. If using a domain and a reverse proxy like CloudFlare, then this prevents a potential IP disclosure from [masscans](https://github.com/robertdavidgraham/masscan)

```sh
# IP or domain (Port 80 is used)
domain = "domain or ip here"

# Key for creating JWTs
token-secret = "something long and unique here"

# Token duration expiry leeway (seconds)
token-leeway = 3

# Duration of token (seconds)
token-duration = 900
```

### Deploying the Backend
In the directory of the cloned repository 

```sh
sudo docker-compose up
```

This will create and run two containers, one for PostgreSQL and the other for the backend. Once this process is done http://domain_or_ip_here.com/ should be accessible via the defined routes.

# Usage
>### *Authorization*
>
>These are the default credentials for the admin user, created using the /database/data.sql
>
>- Type: POST
>- Payload: Username and password as JSON
>- Response: A JWT for accessing restricted routes
>
>```sh
>curl -X POST http://domain.com/auth
>   -H 'Content-Type: application/json'
>   -d '{
>      "username": "admin",
>      "password": "Ihfs&^86f8hs__98987"
>    }'
>```
---
>### *Registration*
>- Type: POST
>- Payload: Username and password as JSON
>- Response: A JWT for accessing restricted routes
>- Requirements: The chosen username can't already be in use. Also, the username and password must conform to their respective formatting requirements.
>
>```sh
>curl -X POST http://domain.com/register
>   -H 'Content-Type: application/json'
>   -d '{
>      "username": "test",
>      "password": "TesT_12345"
>    }'
>```
---
>### *Refresh JWT*
>- Type: GET
>- Header: Bearer Authentication
>- Response: A new JWT for accessing restricted routes
>- Requirements: Token must be within 30 seconds of expiration
>
>```sh
>curl -X GET http://domain.com/utils/refresh
>   -H 'Authorization: Bearer <JWT_GOES_HERE>'
>```
---
>### *Updating Password*
>
>- Type: POST
>- Header: Bearer Authentication
>- Payload: Current and new password as JSON
>- Response: Validity of the operation/request
>- Requirements: The value of the "password" property must match the current password in the database to allow updating the column to the value found in the "new_password" property
>
>```sh
>curl -X POST http://domain.com/utils/update_password
>   -H 'Content-Type: application/json'
>   -H 'Authorization: Bearer <JWT_GOES_HERE>'
>   -d '{
>      "password":"TesT_12345",
>      "new_password":"TesT_123456"
>    }'
>```
---
>### *Upgrading Account*
>
>- Type: POST
>- Header: Bearer Authentication
>- Payload: Payment details as JSON
>- Response: A new JWT for accessing restricted routes for upgraded users (save & load)
>- Requirements: User can not be an admin or already upgraded
>
>```sh
>curl -X POST http://domain.com/utils/upgrade
>   -H 'Content-Type: application/json'
>   -H 'Authorization: Bearer <JWT_GOES_HERE>'
>   -d '{
>      "first_name": "John",
>      "last_name": "Doe",
>      "address": "1600 Pennsylvania Avenue NW, Washington, DC 20500",
>      "card_number": "1234567890123456",
>      "cvc": "123",
>      "exp_month": "03",
>      "exp_year": "25"
>    }'
>```
---
>### *Saving Game Data*
>
>- Type: POST
>- Header: Bearer Authentication
>- Payload: The "opt" property takes a value (1-3) to denote which save slot to overwrite. The "data" property holds a game save data object, which is generated by the game  
>- Response: Validity of the operation/request
>- Requirements: The user must have an upgraded account or be an admin
>
>```sh
>curl -X POST http://domain.com/utils/save
>   -H 'Content-Type: application/json'
>   -H 'Authorization: Bearer <JWT_GOES_HERE>'
>   -d '{
>        "opt": 1,
>        "data": {
>          "player-can_dash": true,
>          "player-hp": 3,
>          "player-x": 564,
>          "room0obj_weapon_light64672": false,
>          "player-items": [
>            {
>              "key": "room0obj_weapon_light64672",
>              "desc": "Average fire power",
>              "bullet_type": 13,
>              "value": 2,
>              "type": 0,
>              "name": "Common pistol"
>            }
>          ],
>          "power-up-2": false,
>          "player-equipped": {
>            "key": "room0obj_weapon_light64672",
>            "desc": "Average Firepower",
>            "bullet_type": 13,
>            "value": 2,
>            "type": 0,
>            "name": "Common Pistol"
>          },
>          "room": "room4",
>          "power-up-4": false,
>          "player-y": 530.199951171875,
>          "player-can_wall_jump": true,
>          "power-up-3": false,
>          "power-up-1": false
>        }
>      }'
>```
---
>### *Retrieving Save Data*
>
>- Type: GET
>- Header: Bearer Authentication 
>- Response: JSON that includes up to three save objects and the timestamps of when they were each submitted
>- Requirements: The user must have an upgraded account or be an admin
>
>```sh
>curl -X GET http://domain.com/utils/load
>   -H 'Authorization: Bearer <JWT_GOES_HERE>'
>```
---
>### *Creating New Admins*
>
>- Type: POST
>- Header: Bearer Authentication
>- Payload: Username and password as JSON
>- Response: Validity of the operation/request
>- Requirements: The user must be an admin
>
>```sh
>curl -X POST http://domain.com/admin/create_admin
>   -H 'Content-Type: application/json'
>   -H 'Authorization: Bearer <JWT_GOES_HERE>'
>   -d '{
>      "username":"admin2",
>      "password":"The_Second_@dm1n"
>    }'
>```
---
>### *Retrieving Users' Data*
>
>- Type: GET
>- Header: Bearer Authentication
>- Parameter: A page number
>- Response: JSON that contains the current page number, total pages available, number of users on the current page, and the data of each listed user (sensitive values omitted)
>- Requirements: The user must be an admin and the desired page number must exist (20 users per page)
>
>```sh
>curl -X GET http://domain.com/admin/users?page=1
>   -H "Authorization: Bearer <JWT_GOES_HERE>"
>```
---
>### *Retrieving a User's Data*
>
>- Type: GET
>- Header: Bearer Authentication
>- Parameter: UUID/Username
>- Response: JSON that contains the data of the desired user (sensitive values omitted)
>- Requirements: The user must be an admin and the target user must exist
>
>```sh
>curl -X GET http://domain.com/admin/user?identifier=<USERNAME_GOES_HERE>
>   -H "Authorization: Bearer <JWT_GOES_HERE>"
>```
>
>**OR**
>
>```sh
>curl -X GET http://domain.com/admin/user?identifier=<UUID_GOES_HERE>
>   -H "Authorization: Bearer <JWT_GOES_HERE>"
>```
---
>### *Deleting a User*
>
>- Type: DELETE
>- Header: Bearer Authentication
>- Parameter: UUID/Username
>- Response: Validity of the operation/request and the username of the deleted user
>- Requirements: The user must be an admin and the target user must exist. 
>- Result: Entries for the user in all tables will be dropped
>
>```sh
>curl -X DELETE http://domain.com/admin/delete?identifier=<USERNAME_GOES_HERE>
>   -H "Authorization: Bearer <JWT_GOES_HERE>"
>```
>
>**OR**
>
>```sh
>curl -X DELETE http://domain.com/admin/delete?identifier=<UUID_GOES_HERE>
>   -H "Authorization: Bearer <JWT_GOES_HERE>"
>```
---
>### *Banning a User*
>
>- Type: POST
>- Header: Bearer Authentication
>- Payload: UUID/Username as JSON
>- Response: Validity of the operation/request and the username of the banned user
>- Requirements: The user must be an admin and the target user must exist and not already be banned
>- Result: Target user can no longer use /auth to generate a JWT for accessing restricted routes
>
>```sh
>curl -X POST http://domain.com/admin/ban
>   -H 'Content-Type: application/json'
>   -H "Authorization: Bearer <JWT_GOES_HERE>"
>   -d '{
>      "identifier":"<USERNAME_GOES_HERE>"
>    }'
>```   
>
>**OR**
>
>```sh
>curl -X POST http://domain.com/admin/ban
>   -H 'Content-Type: application/json'
>   -H "Authorization: Bearer <JWT_GOES_HERE>"
>   -d '{
>      "identifier":"<UUID_GOES_HERE>"
>    }'
>```
---
>### *Unbanning a User*
>
>- Type: POST
>- Header: Bearer Authentication
>- Payload: UUID/Username as JSON
>- Response: Validity of the operation/request and the username of the unbanned user
>- Requirements: The user must be an admin and the target user must exist and be banned
>- Result: Target user regains the ability to use /auth to generate a JWT for accessing restricted routes
>
>```sh
>curl -X POST http://domain.com/admin/unban
>   -H 'Content-Type: application/json'
>   -H "Authorization: Bearer <JWT_GOES_HERE>"
>   -d '{
>      "identifier":"<USERNAME_GOES_HERE>"
>    }'
>```
>
>**OR**
>
>```sh
>curl -X POST http://domain.com/admin/unban
>   -H 'Content-Type: application/json'
>   -H "Authorization: Bearer <JWT_GOES_HERE>"
>   -d '{
>      "identifier":"<UUID_GOES_HERE>"
>    }'
>```
